Ext.define("Valence.common.util.Format",{singleton:true,durationTextSinceDate:function(q,p,b,c){var m=this,k=p||"Y-m-d-H.i.s.u",e=Ext.Date.parse(q,k),d=new Date(),g=60,j=3600,n=86400,l=31536000,o=Math.abs((e.getTime()-d.getTime())/1000),h,a,r;if(Ext.isEmpty(e)||Ext.util.Format.date(e,"Y")==="0001"){return""}if(Ext.isEmpty(b)){if(o<g){return Valence.lang.lit.secondsAgo}else{if(o<j){h=m.getDurationText(Valence.lang.lit.minutesAgo,o,g)}else{if(o<n){h=m.getDurationText(Valence.lang.lit.hoursAgo,o,j)}else{if(o>l){h=m.getDurationText(Valence.lang.lit.yearsAgo,o,l)}else{h=m.getDurationText(Valence.lang.lit.daysAgo,o,n)}}}}}else{if(b=="minute"){a=g}else{if(b=="hour"){a=j}else{if(b=="day"){a=n}else{if(b=="year"){a=l}}}}h=m.getDurationText(c?"{0}":"{0} "+b+"{1} ago",o,a,c)}return Ext.util.Format.format('<span data-qtip="{0}">{1}</span>',Ext.util.Format.date(e,p),h)},getDurationText:function(b,k,a,c){var d=Math.floor(k/a),e=60,f=3600,h=86400,g=31536000,l=Valence.lang.lit,j=d>1?"s":"",m=[b,d];if(d===1){if(a===e){return l.minuteAgo}else{if(a===f){return l.hourAgo}else{if(a===h){return l.dayAgo}else{if(a===g){return l.yearAgo}}}}}if(b.indexOf("VAR1")!==-1){return b.replace("VAR1",d)}if(c){m.push(j)}return m},phone:function(a){if(Ext.isEmpty(a)){return""}if(Ext.isNumber(a)){a+=""}a=a.trim();if(a.length===10){return a.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}else{if(a.length===11){if(a[10]!=0){return a.replace(/(\d{3})(\d{3})(\d{4})(\d{1})/,"$1-$2-$3-$4")}else{return a.substring(0,10).replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}}else{if(a.length===1){return""}}}return a},ssn:function(a){if(Ext.isNumber(a)){a+=""}a=a.trim();if(a.length===9){return a.replace(/(\d{3})(\d{2})(\d{4})/,"$1-$2-$3")}return a},ssnmask:function(a){if(Ext.isNumber(a)){a+=""}a=a.trim();if(a.length===9){return a.replace(/(\d{3})(\d{2})(\d{4})/,"XXX-XX-$3")}return a},zip:function(a){if(Ext.isNumber(a)){a+=""}if(a.trim().length===9){return a.replace(/(\d{5})(\d{4})/,"$1-$2")}return a}});Ext.define("Valence.common.widget.Background",{extend:"Ext.Component",xtype:"widget_background",cls:"w-bg"});Ext.define("Valence.common.widget.Loadmask",{extend:"Ext.Component",xtype:"widget_loadmask",cls:"w-mask-outer",type:"spinner",initComponent:function(){var a=this;Ext.apply(a,{renderTpl:a.buildRenderTpl(),stopDestroy:true});if(Ext.isEmpty(a.renderTo)){Ext.apply(a,{renderTo:Ext.getBody()})}a.callParent(arguments);a.on({scope:a,beforedestroy:a.onBeforeDestroy})},buildRenderTpl:function(){var a=this;if(a.type==="pbar"){return['<div class="w-mask-inner">','<div class="w-mask-title">{text}</div>','<div class="w-mask-pbar">','<span class="w-mask-pbar-full">','<span class="w-mask-pbar-fill"></span>',"</span>","</div>","</div>"]}else{if(a.type==="rect"){return['<div class="w-mask-inner rect">','<div class="ui rect1"></div>','<div class="ui rect2"></div>','<div class="ui rect3"></div>','<div class="ui rect4"></div>','<div class="ui rect5"></div>','<p class="w-mask-title">{text}</p>',"</div>"]}else{if(a.type==="spinner"){return['<div class="w-mask-inner w-spinner">','<div class="circle1 child"></div>','<div class="circle2 child"></div>','<div class="circle3 child"></div>','<div class="circle4 child"></div>','<div class="circle5 child"></div>','<div class="circle6 child"></div>','<div class="circle7 child"></div>','<div class="circle8 child"></div>','<div class="circle9 child"></div>','<div class="circle10 child"></div>','<div class="circle11 child"></div>','<div class="circle12 child"></div>','<p class="w-mask-title">{text}</p>',"</div>"]}}}},initiateDestroy:function(){var a=this;a.el.fadeOut({duration:600,callback:function(){a.destroy()}})},initRenderData:function(){var a=this;return Ext.apply(a.callParent(),{text:a.text})},onBeforeDestroy:function(){var a=this;if(a.stopDestroy){a.stopDestroy=false;a.initiateDestroy()}return false}});Ext.define("Valence.common.util.Helper",{singleton:true,requires:["Ext.util.MixedCollection","Ext.XTemplate","Valence.common.widget.Background","Valence.common.widget.Loadmask"],loadMaskMC:Ext.create("Ext.util.MixedCollection"),buildEmptyText:function(a){var d=this,c="",b;if(Ext.isEmpty(a.heading)){a.heading=Valence.lang.lit.noResults}if(Ext.isEmpty(a.events)){a.events=[]}if(!Ext.isEmpty(a.hideImage)&&a.hideImage){c="display:none;"}if(Ext.isEmpty(a.iconCls)){a.iconCls="vvicon-cloud"}b=new Ext.XTemplate('<div class="vv-empty-text-wrap">','<div class="vv-empty-text-cnt">','<div style="'+c+'"><span class="vvicon {iconCls}"></div>','<div class="vv-empty-text">',"{heading}","</div>",'<tpl if="subText">','<div class="vv-empty-subtext">','<tpl if="events.length == 0">',"{subText}","<tpl else>","{[this.buildSubText(values)]}","</tpl>","</div>","</tpl>","</div>","</div>",{buildSubText:function(j){var e=[j.subText],g=j.events,h;for(var f=0;f<g.length;f++){h=g[f];e.push(Ext.util.Format.format('<span data-event="{0}" class="vv-empty-text-event">{1}</span>',h.event,h.text))}return Ext.bind(Ext.util.Format.format,null,e)()}});return b.applyTemplate(a)},destroyInitialLoadingMask:function(){var a=this,b=Ext.fly("spinner");if(!Ext.isEmpty(b)){b.fadeOut({callback:function(){b.destroy()}})}},destroyLoadMask:function(d){var c=this,b=d||Ext.getBody(),a=c.loadMaskMC.get(b.id);if(a){if(Ext.isClassic){a.el.fadeOut({callback:function(){c.loadMaskMC.remove(a);a.destroy()}})}else{a.element.hide();setTimeout(function(){c.loadMaskMC.remove(a);a.destroy()},300)}}},download:function(c){var b="/valence/vvcall.pgm",a=localStorage.getItem("sid"),d;if(!Ext.isEmpty(c.url)){b=c.url}if(!Ext.isEmpty(c.sid)){a=c.sid}if(Ext.isEmpty(c.omitPortalCredentials)){d=b+"?sid="+a+"&app="+Ext.getUrlParam("app")}else{d=b+"?vv=true"}Ext.iterate(c,function(e,f){d+="&"+e+"="+encodeURI(f)});Ext.core.DomHelper.append(document.body,{tag:"iframe",frameBorder:0,width:0,height:0,css:"display:none;visibility:hidden;height:1px;",src:d})},formatErrorMessage:function(b){var c="",a="";if(!Ext.isEmpty(b.MSG)){c=Valence.lang.lit[b.MSG];if(Ext.isEmpty(c)){return b.MSG}if(c.indexOf("VAR1")!==-1){a=b.VAR1;a=Ext.isEmpty(a)?"":a;c=c.replace("VAR1",a)}if(c.indexOf("VAR2")!==-1){a=b.VAR2;a=Ext.isEmpty(a)?"":a;c=c.replace("VAR2",a)}if(c.indexOf("VAR3")!==-1){a=b.VAR3;a=Ext.isEmpty(a)?"":a;c=c.replace("VAR3",a)}}return c},getDynamicFieldWidth:function(a,j,c,f){var g=this,n=function(){var o=j.measurer,p;if(Ext.isEmpty(o)){p=j.el.createChild();p.addCls("x-form-field x-form-text x-form-text-default").applyStyles({display:"none"});j.measurer=o=new Ext.util.TextMetrics(p);j.on({scope:g,beforedestroy:function(q){if(!Ext.isEmpty(q.measurer)){q.measurer.destroy();q.measurer=null}if(!Ext.isEmpty(q.labelMeasurer)){q.labelMeasurer.destroy();q.labelMeasurer=null}}})}return o},d=function(){var o=j.labelMeasurer,p;if(Ext.isEmpty(o)){p=j.el.createChild();p.addCls("x-form-item-label-inner-default").applyStyles({display:"none"});j.labelMeasurer=o=new Ext.util.TextMetrics(p)}return o},b,m,e;if(Ext.isEmpty(f)){f=false}else{if(f){m=a.FLD+" - "+a.TXT}}if(Ext.isEmpty(m)){if(c){m=a.FLD}else{m=a.TXT}}if(Ext.isEmpty(c)){c=false}if(a.LEN>=750){b=750}else{var l=(a.TYPE==="Numeric"||a.TYPE==="N")?8:"w",k=new Array(a.LEN+1),h=k.join(l);if(a.TYPE==="Date"||a.TYPE==="L"){b=80}else{b=n().getWidth(h);if(b>750){b=750}}}e=d().getWidth(m)+10;return{width:(b>=e)?b:e,labelWidth:e,inputWidth:(b<e)?b+20:b}},getLit:function(d){var b=Ext.isObject(d),a=!b?d:d.lit,c;if(a){c=Valence.lang.lit[a];if(c&&b&&d.var1){c=c.replace("VAR1",Valence.util.Helper.decodeUTF16(d.var1+""))}if(c&&b&&d.var2){c=c.replace("VAR2",Valence.util.Helper.decodeUTF16(d.var2+""))}if(c&&b&&d.var3){c=c.replace("VAR3",Valence.util.Helper.decodeUTF16(d.var3+""))}}else{if(!Ext.isEmpty(d.msg)){c=d.msg}else{if(!Ext.isEmpty(d.MSG)){c=d.MSG}}}return c},loadMask:function(g){var d=this,e=Ext.isObject(g)?g:{text:g},f=e.text,b=e.type||"rect",a=e.renderTo||Ext.getBody(),c;if(Ext.isEmpty(d.loadMaskMC.get(a.id))){if(Ext.isClassic){c=Ext.create("Valence.common.widget.Loadmask",{text:f||"&nbsp;",renderTo:a,type:b})}else{c=Ext.create("Valence.common.widget.Loadmask",{data:{text:f||"&nbsp;"},renderTo:a,type:b})}d.loadMaskMC.add(a.id,c)}},showBgTransition:function(g){var c=this,d=g||{},h=d.position||[1,1],a=d.style||{},f=(Ext.getBody().getWidth()/20)+50,e="scale("+f+")",b;b=Ext.widget("widget_background",{renderTo:Ext.getBody()});b.el.setStyle(Ext.apply(a,{transform:e,"-webkit-transform":e,"-ms-transform":e}));b.showAt(h);return b},uppercaseFirstCharOnly:function(a){if(!Ext.isEmpty(a)){return a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}return""}});Ext.define("Valence.common.util.Snackbar",{singleton:true,config:{cmp:null,queue:[],active:false,anchor:null},buildComponent:function(){var a=this;return Ext.create("Ext.Component",{cls:Ext.Classic?"w-snackbar-outer":"w-snackbar-outer w-snackbar-full",renderTo:Ext.getBody(),tpl:['<div class="w-snackbar-text">',"<span>{text}</span>",'<tpl if="buttonText">','<span class="w-snackbar-btn">{[fm.uppercase(values.buttonText)]}</span>',"</tpl>","</div>"],listeners:{scope:a,render:a.onRenderCmp}})},onClickButton:function(){var a=this,b=a.getActive();if(b&&typeof b.handler==="function"){Ext.callback(b.handler,b.scope||a);a.processHide()}},onDestroyCmp:function(b){var a=this;b.el.un("click",a.onClickButton,a)},onRenderCmp:function(b){var a=this;b.el.on({scope:a,delegate:"span.w-snackbar-btn",click:a.onClickButton,destroy:a.onDestroyCmp})},processHide:function(){var d=this,c=d.getCmp(),e=d.getActive(),b=e.push||false,a=d.getQueue();d.setActive(false);c.el.removeCls("is-active");if(b||!Ext.isClassic){Ext.getBody().down("div").removeCls("is-active")}if(a&&a.length>0){setTimeout(function(){d.show(a[0],true)},300)}},show:function(f,a){var d=this,e=Ext.isObject(f)?f:{text:f,duration:4000},b=e.push||false,c;if(!d.getActive()){if(Ext.isClassic){d.setActive(e)}c=d.getCmp();if(!c){c=d.buildComponent();d.setCmp(c)}if(Ext.isClassic){c.update(e)}else{c.setData(e);d.setActive(e)}if(b){Ext.getBody().down("div").addCls("w-snackbar-push is-active");c.el.addCls("w-snackbar-full");if(Ext.isClassic){if(d.getAnchor()!=="tl-bl"){c.el.anchorTo(Ext.getBody(),"tl-bl");d.setAnchor("tl-bl")}}else{c.el.alignTo(Ext.getBody(),"tl-bl")}}else{c.el.removeCls("w-snackbar-full");if(Ext.isClassic){if(d.getAnchor()!=="t-b"){c.el.anchorTo(Ext.getBody(),"t-b");d.setAnchor("t-b")}}else{c.el.alignTo(Ext.getBody(),"t-b")}}c.show().el.addCls("is-active");setTimeout(function(){d.processHide()},e.duration||4000);if(a){Ext.Array.removeAt(d.getQueue(),0)}}else{d.getQueue()?d.getQueue().push(e):d.setQueue([e])}}});Ext.define("Valence.common.util.Dialog",{singleton:true,config:{cmp:null,scope:this,fnc:null},show:function(c){var h=this,k=c.title||null,d=c.msg||null,j=c.buttons||null,a=c.cfg||null,p=c.scope||this,f=c.handler||null,b=c.minWidth||null,n=c.minHeight||null,m=c.noButtons||false,g=false,e={ui:"dialog",scrollable:"y",autoWidth:true,minHeight:n,maxHeight:450,minWidth:b,maxWidth:600,resizable:false,closeAction:"destroy",closable:false,title:k,header:(k!==null),buttonAlign:"right",modal:true,html:d,autoShow:true};if(!j&&!m){Ext.log("An array of buttons must be passed")}else{if(a){Ext.apply(e,a)}if(!m){for(var l=0;l<j.length;l++){j[l].scope=h;j[l].handler=h.onClickButton;if(j[l].focusOnShow){g=true}}e.buttons=j}else{e.buttons=[]}if(g){Ext.apply(e,{listeners:{scope:h,afterrender:h.onAfterRender}})}h.setCmp(Ext.widget("window",e));h.setScope(p);h.setFnc(f)}},onAfterRender:function(b){var a=this,c=b.down("button[focusOnShow=true]");if(!Ext.isEmpty(c)){setTimeout(function(){c.focus()},150)}},onClickButton:function(a){var c=this,d=c.getFnc(),b=c.getScope();c.getCmp().destroy();if(d){Ext.callback(d,b,[a.parmText||Ext.util.Format.lowercase(a.getText())]);c.setFnc(null);c.setScope(this)}}});Ext.define("Valence.common.ux.grid.Renderer",{singleton:true,tick:function(a){if(a==="Y"||a===true||a==1){return'<div class="vvicon-in-cell vvicon-checkmark"></div>'}}});Ext.define("Valence.common.ux.grid.column.MenuColumn",{extend:"Ext.grid.column.Column",xtype:"menucolumn",width:40,dataIndex:"menuColumn",showMenu:true,draggable:false,sortable:false,menuDisabled:true,renderer:function(){return'<div class ="vvicon-more2 menu-column"></div>'}});Ext.define("Valence.common.ux.grid.column.RemoveColumn",{extend:"Ext.grid.column.Column",xtype:"removecolumn",width:40,dataIndex:"removeColumn",removeColumn:true,draggable:false,sortable:false,menuDisabled:true,renderer:function(){return'<div class ="vvicon-cancel-circle menu-column"></div>'}});Ext.define("Valence.common.ux.plugin.EmptyText",{alias:"plugin.emptytext",extend:"Ext.plugin.Abstract",requires:["Ext.dom.Helper","Valence.common.util.Helper"],pluginId:"emptytext",config:{parentComponent:null,emptyElement:null,hiddenClass:"vv-plugin-empty-text-hidden"},init:function(b){var a=this;a.setParentComponent(b);a.setup(b)},createEmptyElement:function(e){var d=this,b="vv-plugin-empty-text",a=e.emptyText,c=e.getEl();if(Ext.isString(a)){a={heading:a}}if(Ext.isEmpty(e.isEmpty)){e.isEmpty=false}if(!e.isEmpty){b+=" "+d.getHiddenClass()}d.setEmptyElement(Ext.get(Ext.dom.Helper.insertFirst(c,{tag:"div",cls:b,cn:[Valence.common.util.Helper.buildEmptyText(a)]})));c.mon(c,{scope:d,delegate:"span.vv-empty-text-event",click:d.onClickParentComponent})},onClickParentComponent:function(f){var d=this,a=Ext.get(f.getTarget()),c=a.getAttribute("data-event"),b=d.getParentComponent();if(c&&!Ext.isEmpty(b)){b.fireEvent(c,b)}},setIsEmpty:function(d){var c=this,b=c.getParentComponent(),a=c.getEmptyElement();b.isEmpty=d;if(a){if(!d){a.addCls(c.getHiddenClass())}else{a.removeCls(c.getHiddenClass())}}},setup:function(b){var a=this;if(Ext.isEmpty(b.setIsEmpty)&&!Ext.isEmpty(b.emptyText)){b.setIsEmpty=Ext.bind(a.setIsEmpty,a);if(!Ext.isEmpty(b.getEl())){a.createEmptyElement(b)}else{b.on({scope:a,afterrender:a.createEmptyElement})}}else{if(Ext.isEmpty(b.setIsEmpty)){Ext.log({msg:"Valence.common.plugin.EmptyText not able to act on component because it already has a setIsEmpty method."})}else{Ext.log({msg:"Valence.common.plugin.EmptyText is attached but emptyText is not set."})}}}});Ext.define("Valence.common.ux.plugin.form.field.ClearValue",{extend:"Ext.plugin.Abstract",alias:"plugin.formfieldclearvalue",config:{boundCmp:null,triggerKey:"clear"},pluginId:"clearvalue",disabled:false,verbose:false,hideOnBlur:false,init:function(e){if(!e.isFormField){if(this.verbose){console.log("Must be a form field")}return}var d=this,c=e.getTriggers(),b=d.getTriggerKey(),a={scope:d,change:d.onChange,reset:d.onReset,render:d.onRender};d.setBoundCmp(e);if(!c){c={}}if(c[b]!==undefined){if(d.verbose){console.error("Component "+e.getId()+' already has a trigger with the key "'+b+'". Will not initialize "formfieldclearvalue" on this field.')}return}c[b]=d.defineTrigger();e.enableKeyEvents=true;if(d.hideOnBlur){Ext.apply(a,{blur:d.onBlur,focus:d.onFocus})}e.on(a);e.setTriggers(c);d.callParent(arguments)},disable:function(){var c=this,a=c.getCmp(),b=a.getTriggers();if(!Ext.isEmpty(b.clear)){b.clear.hide();b.clear.el.fadeOut()}c.disabled=true;c.callParent(arguments)},enable:function(){var c=this,a=c.getCmp(),b=a.getTriggers();c.disabled=false;if(!Ext.isEmpty(b.clear)){if(Ext.isEmpty(a.getValue())||a.readOnly){b.clear.setHidden(true);b.clear.el.fadeOut()}}c.callParent(arguments)},onClickClearInput:function(){var d=this,c=d.getCmp(),b=d.getTriggerKey(),a=c.triggers[b];c.setValue("");a.hide();c.fireEvent("clear",c)},onChange:function(d){var c=this,e=d.getValue(),b=c.getTriggerKey(),a=d.triggers[b];if(d.hasFocus){if(!c.disabled&&!d.readOnly){a[!Ext.isEmpty(e)?"show":"hide"]()}else{a.el.fadeOut()}}},onReset:function(d){var c=this,b=c.getTriggerKey(),a=d.triggers[b];a.hide()},onBlur:function(d){var c=this,b=c.getTriggerKey(),a=d.triggers[b];if(!Ext.isEmpty(a)){a.hide()}},onFocus:function(d){var c=this,b=c.getTriggerKey(),a=d.triggers[b];if(!Ext.isEmpty(a)&&!Ext.isEmpty(d.getValue())){a.show()}},onRender:function(c){var b=this,d=c.getValue(),a=b.getTriggerKey();if(!b.disabled&&!c.readOnly){if(!Ext.isEmpty(d)){c.triggers[a].el.fadeIn()}}else{c.triggers[a].el.fadeOut()}},defineTrigger:function(){var a=this;return{scope:a,weight:1,hidden:true,cls:"vvicon-cancel-circle vv-icon-trigger-medium",handler:a.onClickClearInput,style:"display:none;"}}});Ext.define("Valence.common.ux.plugin.grid.Multisort",{extend:"Ext.plugin.Abstract",requires:["Ext.ux.BoxReorderer"],alias:"plugin.gridmultisort",config:{additionalItems:[],boundCmp:null,dock:"bottom",height:39,hideWhenEmpty:true,useColumnDescription:true,ui:"default",cls:null},init:function(d){var g=this,b="p-multisort-bar",h=g.getAdditionalItems(),a=g.getHideWhenEmpty(),c=[{xtype:"tbtext",itemId:"sortText",text:Valence.lang.lit.sort,reorderable:false,hidden:!a,margin:0}],f;if(h.length>0){c.push({xtype:"tbfill",reorderable:false});for(var e=0;e<h.length;e++){c.push(Ext.apply(h[e],{reorderable:false}))}}d.multiColumnSort=true;if(g.getCls()){b+=" "+g.getCls()}f=d.addDocked({xtype:"toolbar",ui:g.getUi(),style:{opacity:(a)?0:1},hidden:a,dock:g.getDock(),height:g.getHeight(),itemId:"multisort_bar",cls:b,defaults:{reorderable:true},plugins:Ext.create("Ext.ux.BoxReorderer",{listeners:{scope:g,drop:g.onDropItem}}),items:c,listeners:{scope:g,el:{scope:g,delegate:"div.p-multisort-item",click:g.onClickBarItem}}});d.on({scope:g,sortchange:g.onSortChangeGrid});g.setBoundCmp(d)},onClickBarItem:function(f,d){var j=this,k=Ext.getCmp(d.id),g=Ext.get(f.getTarget());if(g.hasCls("multisort-remove")){k.el.fadeOut({callback:function(){k.destroy();j.onDropItem()}})}else{var a=j.getBoundCmp(),l=a.getStore(),h=l.getSorters(),c=function(){var e=[];for(var m=0;m<h.items.length;m++){e.push(h.items[m])}return e},b;if(!Ext.isEmpty(k)&&!Ext.isEmpty(k.property)){b=h.get(k.property);if(!Ext.isEmpty(b)){b.toggle();l.setSorters(c())}}}},onClickRemove:function(f,a){var d=this,b=Ext.get(a),g=b.up("div.p-multisort-item").id,c=Ext.getCmp(g);c.el.fadeOut({callback:function(){c.destroy();d.onDropItem();d.onSortChangeGrid()}})},onDropItem:function(){var e=this,b=e.getBoundCmp(),g=b.getStore(),d=b.down("#multisort_bar"),a=d.query("[removable]"),f=[];for(var c=0;c<a.length;c++){f.push({property:a[c].property,direction:a[c].direction})}g.sort(f);e.onSortChangeGrid();b.fireEvent("multisortdropitem",b,e)},onSortChangeGrid:function(){var j=this,a=j.getBoundCmp(),g=a.getStore(),h=g.getSorters(),f=a.down("#multisort_bar"),k=Ext.util.Format,o='<b>{0}</b> {1}<div class="multisort-remove vvicon-cancel-circle"></div>',d="<b>{0}</b> {1}",b=j.getHideWhenEmpty(),p,n,m,e,c;n=(f)?f.query("[removable]"):[];Ext.suspendLayouts();for(var l=0;l<n.length;l++){n[l].destroy()}n.length=0;for(var l=0;l<h.items.length;l++){p=h.items[l];if(j.getUseColumnDescription()){e=a.headerCt.items.findIndex("dataIndex",p.getProperty());if(e!==-1){c=a.headerCt.items.getAt(e);m=c.text||c.header||k.uppercase(p.getProperty())}}else{m=k.uppercase(p.getProperty())}n.push({xtype:"component",cls:"p-multisort-item",margin:"0 5 0 0",html:Ext.String.format((l===0)?d:o,m,k.lowercase(p.getDirection())),removable:true,property:p.getProperty(),direction:p.getDirection()})}f.insert(1,n);if(h.items.length>0){f.show();f.el.fadeIn();if(!b){f.down("#sortText").show()}}else{if(b){f.el.fadeOut({callback:function(){f.hide()}})}}Ext.resumeLayouts(true)}});Ext.define("Valence.common.view.filevalidator.FilevalidatorModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.filevalidator",stores:{Libraries:{fields:["VVOBJECT"],autoLoad:true,proxy:{type:"ajax",url:"/valence/vvcall.pgm",reader:{type:"json",rootProperty:"VVDSUTIL3"},extraParams:{action:"getLibraries",pgm:"vvdatasrc"}},listeners:{load:function(a){a.insert(0,{VVOBJECT:"*LIBL"})}}}},data:{includeFileData:1}});Ext.define("Valence.common.view.filevalidator.Select",{extend:"Ext.window.Window",xtype:"filevalidator-select",layout:"fit",height:350,width:600,initComponent:function(){var a=this;Ext.apply(a,{buttons:a.buildButtons(),items:a.buildItems()});a.callParent(arguments)},buildButtons:function(){var a=this;return[{text:Valence.lang.lit.cancel,scope:a,handler:"onEsc"}]},buildItems:function(){var a=this;return[{xtype:"grid",ui:"background",margin:"8 16 16 16",store:Ext.create("Ext.data.Store",{autoDestroy:true,proxy:{type:"memory"},data:a.content.VVDSDATA04}),columns:{defaults:{menuDisabled:true,flex:1},items:[{text:Valence.lang.lit.file,dataIndex:"FILE"},{text:Valence.lang.lit.library,dataIndex:"LIB"},{text:Valence.lang.lit.description,dataIndex:"TEXT",flex:2}]},listeners:{scope:a,itemclick:"onItemclick"}}]},onItemclick:function(a,b){this.fireEvent("itemclick",b,this)}});Ext.define("Valence.common.view.filevalidator.SelectMember",{extend:"Ext.window.Window",xtype:"filevalidator-selectmember",layout:"fit",height:350,width:450,initComponent:function(){var a=this;Ext.apply(a,{buttons:a.buildButtons(),items:a.buildItems()});a.callParent(arguments)},buildButtons:function(){var a=this;return[{text:Valence.lang.lit.cancel,scope:a,handler:"onEsc"}]},buildItems:function(){var a=this;return[{xtype:"grid",ui:"background",margin:"8 16 16 16",store:Ext.create("Ext.data.Store",{autoDestroy:true,proxy:{type:"memory"},data:a.content.VVDSDATA06}),columns:{defaults:{menuDisabled:true,flex:1},items:[{text:Valence.lang.lit.member,dataIndex:"MEMBER"},{text:Valence.lang.lit.description,dataIndex:"TEXT",flex:2}]},listeners:{scope:a,itemclick:"onItemclick"}}]},onItemclick:function(a,b){this.fireEvent("itemclick",b,this)}});Ext.define("Valence.common.view.filevalidator.FilevalidatorController",{extend:"Ext.app.ViewController",alias:"controller.filevalidator",requires:["Valence.common.view.filevalidator.Select","Valence.common.view.filevalidator.SelectMember"],onClickAddFile:function(b){var c=this,a=c.getView();if(a.isValid()){a.el.mask();c.processValidateFile().then(c.processAddFile).then(null,c.processAddFileReject)}},onItemclickFileSelection:function(d,a){var c=this,b=c.getViewModel();b.set({filename:d.get("FILE"),member:""});b.notify();c.onClickAddFile();a.destroy()},onItemclickFileSelectionMember:function(d,a){var c=this,b=c.getViewModel();b.set({member:d.get("MEMBER")});b.notify();c.onClickAddFile();a.destroy()},onSpecialkeyFile:function(b,f){var d=this,c=d.getViewModel();if(f.getKey()===f.ENTER&&!c.get("filevalidator_hideActionButton")){d.onClickAddFile()}else{if(f.getKey()===f.ENTER){var a=d.getView();a.fireEvent("enterkey",a,b)}}},processAddFile:function(c){var b=c.scope,a=b.getView(),d=(!Ext.isEmpty(c.params.member))?c.params.member:"";b.fireViewEvent("filevalid",a,Ext.apply(c,{FILE:a.lookupReference("filefield").getValue(),MEMBER:d}));a.el.unmask()},processAddFileReject:function(c){var b=c.scope,a=b.getView();if(!Ext.isEmpty(c.VVDSDATA04)){Ext.widget("filevalidator-select",{title:c.totalCount+" File(s) Found",renderTo:Ext.getBody(),content:c,listeners:{scope:b,itemclick:"onItemclickFileSelection"}}).show()}else{if(!Ext.isEmpty(c.VVDSDATA06)){Ext.widget("filevalidator-selectmember",{title:c.totalCount+" Member(s) Found",renderTo:Ext.getBody(),content:c,listeners:{scope:b,itemclick:"onItemclickFileSelectionMember"}}).show()}else{b.fireViewEvent("fileinvalid");if(c.success==="3"){Valence.common.util.Snackbar.show(Valence.lang.lit.noResults)}else{Valence.common.util.Snackbar.show(Valence.common.util.Helper.getLit({lit:"fileNotFound",var1:c.params.file}))}}}a.el.unmask()},processValidateFile:function(){var d=this,b=Ext.create("Ext.Deferred"),c=d.getViewModel(),a=d.getView(),e=a.getValues(),f={pgm:"vvdatasrc",action:"getFileFields",fileData:c.get("includeFileData")};Ext.apply(f,e);Ext.Ajax.request({url:"/valence/vvcall.pgm",params:f,success:function(g){var h=Ext.decode(g.responseText);if(h.success===true){b.resolve(Ext.apply(h,{scope:d,params:f}))}else{b.reject(Ext.apply(h,{scope:d,params:f}))}}});return b.promise}});Ext.define("Valence.common.view.filevalidator.Filevalidator",{extend:"Ext.form.Panel",requires:["Valence.common.view.filevalidator.FilevalidatorModel","Valence.common.view.filevalidator.FilevalidatorController"],xtype:"filevalidator",viewModel:{type:"filevalidator"},controller:"filevalidator",defaults:{labelAlign:"top",labelSeparator:"",width:"100%"},bodyPadding:"8 24",initComponent:function(){var a=this;if(Ext.isEmpty(a.title)){Ext.apply(a,{title:Valence.lang.lit.addFile})}Ext.apply(a,{items:a.buildItems()});a.callParent(arguments)},buildItems:function(){var a=this;return[{xtype:"hiddenfield",name:"member",bind:{value:"{member}"}},{xtype:"textfield",reference:"filefield",forceUppercase:true,name:"file",preventMark:true,maxLength:10,enforceMaxLength:true,allowBlank:false,fieldLabel:Valence.lang.lit.file,bind:{value:"{filename}"},listeners:{specialkey:"onSpecialkeyFile"}},{xtype:"combo",value:"*LIBL",bind:{store:"{Libraries}",hidden:"{filevalidator_hideLibrary}"},name:"lib",queryMode:"local",displayField:"VVOBJECT",valueField:"VVOBJECT",forceSelection:true,fieldLabel:Valence.lang.lit.library,triggerAction:"all",listeners:{specialkey:"onSpecialkeyFile"}},{xtype:"button",ui:"primary",formBind:true,margin:"8 0 0 0",text:(Ext.isEmpty(a.actionButton))?Valence.lang.lit.add:a.actionButton,handler:"onClickAddFile",bind:{hidden:"{filevalidator_hideActionButton}"}}]}});Ext.define("Valence.common.widget.Appbar",{extend:"Ext.toolbar.Toolbar",requires:["Ext.menu.Menu","Ext.button.Cycle","Valence.common.ux.plugin.form.field.ClearValue"],xtype:"widget_appbar",cls:"x-toolbar-appbar",icons:null,noFill:false,endItems:[],bind:{hideDepth:"{appBarHideDepth}",UI:"{appBarUI}",searchActionsLength:"{appBarSearchActionsLength}",fireFilterEvtOnly:"{appBarFireFilterEvtOnly}",searchComponent:"{appBarSearchCmp}",appBarTitleMenuShowOnClick:"{appBarTitleMenuShowOnClick}"},config:{appBarTitleMenuShowOnClick:false,fireFilterEvtOnly:false,fireFilterEnterKeyOnEmpty:false,searchAction:false,searchActionValue:null,searchActionsLength:3,searchActionStore:null,searchComponent:null,searchText:""},initComponent:function(){var b=this;b.items=b.items||[];b.items.splice(0,0,{ui:"plain",iconCls:"vvicon-arrow-left8",itemId:"backbutton",bind:{hidden:"{!appBarBackIcon}"},scope:b,handler:b.onClickBack},{ui:"plain",iconCls:"vvicon-menu7",bind:{hidden:"{!appBarNavIcon}"},scope:b,itemId:"navbutton",handler:b.onClickNavigation},{xtype:"tbtext",itemId:"title",cls:"appbar-title",hidden:true,bind:{text:"{appBarTitle}",hidden:"{appBarTitleHide}"},listeners:{el:{scope:b,click:b.onClickTitle}}},{xtype:"cycle",showText:true,itemId:"title_menu",cls:"appbar-title",_focusCls:null,_menuActiveCls:null,_pressedCls:null,overCls:null,depth:false,scale:"large",uppercase:false,bind:{hidden:"{appBarTitleMenuHide}",menu:"{appBarTitleMenu}"},listeners:{scope:b,change:b.onChangeTitleMenu,click:b.onClickTitleMenu}});if(!b.noFill){b.items.push("->")}if(b.icons){for(var a=0;a<b.icons.length;a++){b.items.push(b.icons[a])}}if(b.searchAction){b.setSearchActionStore(Ext.create("Ext.data.Store",{fields:["searchname","searchevent","searchcmptitle","searchfieldname","searchcmprec"],data:[{searchname:"Looking for records",searchevent:null,searchcmptitle:null,searchfieldname:null,searchcmprec:null}]}));b.items.push({xtype:"combo",reference:"searchField",width:300,minChars:2,hideLabel:true,hideTrigger:true,clearValuePlugin:false,forceSelection:false,store:b.getSearchActionStore(),displayField:"name",tpl:['<tpl for=".">','<tpl if="searchcmptitle">','<div class="x-boundlist-item">','<div style="width:100%;padding:8px;display:table;">','<div style="display:table-cell;vertical-align:middle;">','<div style="font-size:16px;font-weight:500;color:rgba(0,0,0,.87)">{searchname}</div>','<div style="font-size:13px;font-weight:400;color:rgba(0,0,0,.54)">Select from {searchcmptitle}</div>',"</div>","</div>","</div>","<tpl elseif=\"searchevent == 'filter-0'\">",'<div class="x-boundlist-item" style="border-top: 1px solid #ddd">','<div style="width:100%;padding:8px;display:table;">','<div style="display:table-cell;vertical-align:middle;">','<div style="line-height:16px; font-size:14px;font-weight:500;color:rgba(0,0,0,.54); text-align:center;"><span style="position: relative; top:1px;line-height:14px; font-size:14px; padding-right:16px;" class="vvicon-filter3"></span>{searchname}</div>',"</div>","</div>","</div>","<tpl else>",'<div class="x-boundlist-item" style="border-top: 1px solid #ddd">','<div style="width:100%;padding:8px;display:table;">','<div style="display:table-cell;vertical-align:middle;">','<tpl if="searchevent">','<div style="line-height:16px;font-size:14px;font-weight:500;color:rgba(0,0,0,.54);text-align:center;">','<span style="position: relative; top:1px;line-height:14px; font-size:14px; padding-right:16px;" class="vvicon-filter3"></span>',"{searchname}","</div>","<tpl else>",'<div style="font-size:14px;font-weight:500;color:rgba(0,0,0,.54)">',"{searchname}","</div>","</tpl>","</div>","</div>","</div>","</tpl>","</tpl>"],plugins:[{ptype:"formfieldclearvalue",hideOnBlur:true}],listeners:{focus:function(){b.oldUI=b.ui;b.setUI("background")},blur:function(){b.setUI(b.oldUI)},change:{fn:b.onChangeSearchCmp,buffer:500},select:b.onSelectSearchCmp,scope:b},bind:{hidden:"{!appBarSearch}",emptyText:"{appBarSearchEmptyText}"}})}else{b.items.push({xtype:"textfield",reference:"searchField",width:300,itemId:"filterfield",hideLabel:true,clearValuePlugin:false,hideMode:"offsets",plugins:[{ptype:"formfieldclearvalue",hideOnBlur:true}],listeners:{focus:function(){b.oldUI=b.ui;b.setUI("background");b.fireEvent("focussearch",b)},blur:function(){b.setUI(b.oldUI);b.fireEvent("blursearch",b)},change:b.onChangeFilter,clear:b.onClearFilterTrigger,specialkey:b.onSpecialKeyFilter,scope:b},bind:{hidden:"{!appBarSearch}",emptyText:"{appBarSearchEmptyText}",value:"{appBarSearchValue}"}})}b.items.push({ui:"plain",iconCls:"vvicon-search2",hideMode:"offsets",bind:{hidden:"{!appBarSearchIcon}"}},{ui:"plain",iconCls:"vvicon-more2",hideMode:"offsets",bind:{hidden:"{!appBarMoreIcon}"}});if(!Ext.isEmpty(b.endItems)&&Ext.isArray(b.endItems)){b.items=Ext.Array.merge(b.items,b.endItems)}b.callParent(arguments)},onClickTitleMenu:function(b){var a=this;if(a.getAppBarTitleMenuShowOnClick()){b.showMenu()}},getSearchComponent:function(){var a=this,b=a.searchComponent;if(!Ext.isEmpty(b)){if(!Ext.isArray(b)){return[b]}}return b},onChangeTitleMenu:function(d,c){var b=this,a=c.event;if(a){b.fireEvent(a,b,c)}},onChangeFilter:function(a,c){var b=this;b.fireEvent("filterchange",a,c);if(!Ext.isEmpty(b.getSearchComponent())){b.performSearch(c,a)}},onChangeSearchCmp:function(a,c){var b=this;b.performActionSearch(c);b.setSearchActionValue(c)},onClearFilterTrigger:function(a){var b=this;b.fireEvent("cleartrigger",a)},onClickBack:function(b){var c=this,a=b||c.down("#backbutton");c.fireEvent("back",c,a)},onClickNavigation:function(a){var b=this;b.fireEvent("navigation",b,a)},onClickTitle:function(a){var b=this;b.fireEvent("titleclick",b,a)},onSelectSearchCmp:function(c,d){var b=this,a=d.get("searchevent");if(/filter/.test(a)){b.performSearch(b.getSearchActionValue(),null,a.split("-")[1]);return}b.fireEvent(d.get("searchevent"),c,d)},onSpecialKeyFilter:function(a,d){var b=this,c=a.getValue();if(d.getKey()==d.ENTER){if(!Ext.isEmpty(c)||b.getFireFilterEnterKeyOnEmpty()){b.fireEvent("filterenterkey",a,c)}}},setAppBarTitleMenu:function(e){var b=this,d=b.down("#title"),c=b.down("#title_menu"),a;if(Ext.isEmpty(e)){d.show();c.hide()}else{d.hide();for(i=0;i<e.items;i++){a=e.items[i];a=Ext.applyIf({group:b.id,itemIndex:i,checked:a.checked||false},a);e.items.push(a)}c.setMenu(e);c.show()}},setHideDepth:function(b){var a=this;if(b){a.el.addCls("x-toolbar-appbar-no-depth")}else{a.el.removeCls("x-toolbar-appbar-no-depth")}},performActionSearch:function(v){var u=this,b=new RegExp(v,"i"),r=u.getSearchComponent(),g=u.getSearchActionStore(),h=u.getSearchActionsLength()||3,p=[],l=[],f,n,q,k,a,e,m,o,c,d;g.removeAll();for(var t=0;t<r.length;t++){n=r[t];o=n.appBarSearchFields;d=0;if(typeof o==="undefined"){Ext.log({msg:"Appbar search component does not have any search fields"});continue}c=o[0];q=(typeof n.getStore==="function")?n.getStore():null;if(!q){Ext.log({msg:"Appbar search component does not have a getStore method"});continue}e=n.appBarSearchEvent;if(Ext.isEmpty(e)){Ext.log({msg:"Appbar search component does not have a search event"});continue}m=n.getTitle==="function"?n.getTitle():n.getHeader().getTitle().text;if(m.indexOf("(")>0){m=m.split("(")[0]}a=q.queryBy(function(w){for(var j=0;j<o.length;j++){if(b.test(w.get(o[j]))){return true}}return false});a=a.items;f=a.length<h?a.length:h;for(var s=0;s<a.length;s++){k=a[s];d++;if(q.isFiltered()&&q.findExact("id",k.get("id"))==-1){continue}p.push({searchfieldname:c,searchname:k.get(c),searchevent:e,searchcmptitle:m,searchcmprec:k});if(p.length==f){break}}if(d>0){l.push({searchfieldname:null,searchname:Ext.util.Format.format('Filter <i>{0}</i> for "{1}"',m,v),searchevent:"filter-"+t,searchcmptitle:null,searchcmprec:null})}}p=Ext.Array.merge(p,l);g.loadRawData(p)},performSearch:function(h,b,a){var f=this,e=f.getSearchComponent(),g;if(Ext.isEmpty(a)){a=0}e=e[a];g=Ext.isFunction(e.getStore)?e.getStore():null;if(typeof e.filterBy==="function"){g=e}if(!g){Ext.log({msg:"Appbar search component does not have a getStore method"})}else{var d=new RegExp(h,"i"),c=e.appBarSearchFields;if(!c){c=g.getModel().getFields().map(function(j){return j.name})}if(Ext.isFunction(e.showFilterBar)){e.showFilterBar(h,b)}if(!f.getFireFilterEvtOnly()){Valence.util.Helper.processTypedInputFilter(g,c,h,"appbarsearch")}else{f.fireEvent("searchcmpchange",e,h)}}},buildFilterTag:function(){return new Ext.XTemplate('<div class="filter-cont">','<div class="filter-label"><span data-event="clearfilter" class="vvicon-cross"></span>Filtered by: "{filter}"</div>',"</div>")},onClickFilterTag:function(g,b,j){var f=this,h=b.getAttribute("data-event"),c=j.cmp,a;if(!Ext.isEmpty(h)&&h=="clearfilter"){c.filterTag.hide();c.getStore().clearFilter();c.fireEvent(h,c)}}});Ext.define("Valence.common.widget.DockedSearch",{extend:"Ext.toolbar.Toolbar",requires:["Ext.form.field.Text","Valence.common.ux.plugin.form.field.ClearValue"],xtype:"widget_dockedsearch",padding:0,dock:"top",config:{store:null,fields:null},initComponent:function(){var a=this;Ext.apply(a,{items:a.buildItems()});a.callParent(arguments)},buildItems:function(){var a=this;return[{xtype:"textfield",itemId:"dockedSearchField",emptyText:Valence.lang.lit.search,formItemCls:"vv-form-item-full-width",plugins:[{ptype:"formfieldclearvalue"}],listeners:{scope:a,change:a.onChangeSearch}}]},getSearchValue:function(){var b=this,a=b.down("#dockedSearchField");if(!Ext.isEmpty(a)){return a.getValue()}return""},onChangeSearch:function(c,e){var d=this,b=d.getStore(),a=d.getFields();if(!Ext.isEmpty(b)&&!Ext.isEmpty(a)){Valence.util.Helper.processTypedInputFilter(b,a,e,"dockedsearch")}else{d.fireEvent("searchchanged",d,e,c)}}});Ext.define("Valence.common.widget.FabWrapper",{extend:"Ext.Container",xtype:"widget_fabwrapper",width:96,cls:"vv-fabwrapper",positionPrefix:"vv-fabwrapper-",position:"br",initComponent:function(){var a=this;if(a.position){a.cls+=" "+a.positionPrefix+a.position}Ext.apply(a,{layout:{type:"vbox",align:"middle"},shadow:false,floating:true,defaults:{floating:false,margin:"16 0 0 0",xtype:"widget_floatingactionbutton",position:null,inFabWrapper:true,listeners:{scope:a,click:a.hideSubActions}}});a.callParent(arguments)},hideSubActions:function(){var c=this,b=c.query("[subAction]");for(var a=0;a<b.length;a++){b[a].hide()}},onParentLayout:function(){var a=this;a.el.alignTo(a.floatParent,a.position+"-"+a.position,[0,-32])},onRender:function(){var a=this;a.callParent(arguments);a.el.on({scope:a,mouseenter:a.showSubActions,mouseleave:a.hideSubActions});setTimeout(function(){a.el.alignTo(a.floatParent,a.position+"-"+a.position,[0,-32]);a.mon(a.floatParent,"afterlayout",a.onParentLayout,a)},100)},showSubActions:function(){var b=this,c=b.query("[subAction]");for(var a=0;a<c.length;a++){c[a].show()}}});Ext.define("Valence.common.widget.FloatingActionButton",{extend:"Ext.Button",xtype:"widget_floatingactionbutton",iconCls:"vvicon-plus2",position:"br",positionPrefix:"x-btn-position-",positionOffset:null,floating:true,subAction:false,initComponent:function(){var a=this;if(!Ext.isEmpty(a.position)){a.cls=a.positionPrefix+a.position}if(a.subAction){a.cls+=" x-btn-floating-action-sub"}Ext.apply(a,{ui:"floating-action",height:(!a.subAction)?56:40,width:(!a.subAction)?56:40,shadow:false});a.callParent(arguments);setTimeout(function(){if(a.inFabWrapper&&!a.subAction){a.show()}},500)},hide:function(){var a=this;if(!Ext.isEmpty(a.el)){a.el.removeCls("x-btn-scale-in")}},applyOffsets:function(){var j=this,e=j.positionOffset;if(!Ext.isEmpty(j.position)&&!Ext.isEmpty(e)&&e.length===2){var h=j.positionPrefix+j.position,k=Ext.util.CSS.getRule("."+h);if(!Ext.isEmpty(k)){var d=new RegExp(/[a-zA-Z]+/g),f=new RegExp(/\d+/),a=k.style.getPropertyValue("bottom"),c=(!Ext.isEmpty(a))?f.exec(a):null,m=(!Ext.isEmpty(a))?d.exec(a):null,l=k.style.getPropertyValue("right"),g=(!Ext.isEmpty(l))?f.exec(l):null,b=(!Ext.isEmpty(l))?d.exec(l):null;if(!Ext.isEmpty(c)&&!Ext.isEmpty(m)){c=parseInt(c[0])+e[0];j.setStyle("bottom",c+m)}if(!Ext.isEmpty(g)&&!Ext.isEmpty(b)){g=parseInt(g[0])+e[1];j.setStyle("right",g+b)}}}},show:function(){var b=this,a=function(){if(!Ext.isEmpty(b.el)){b.el.addCls("x-btn-scale-in")}};b.callParent(arguments);if(!Ext.isEmpty(b.positionOffset)){b.applyOffsets();b.positionOffset=null;setTimeout(function(){a()},150)}else{if(!Ext.isEmpty(b.el)){a()}}}});Ext.define("Valence.common.widget.MatTabs",{extend:"Ext.tab.Panel",xtype:"widget_mattabs",stretchTabs:true,pack:"start",centerTabs:false,initComponent:function(){var a=this;a.cls+=" mattabs";a.callParent(arguments)},applyTabBar:function(a){var c=this,b=(c.tabBarHeaderPosition!=null)?c.getHeaderPosition():c.getTabPosition();if(c.centerTabs){c.pack="center"}return new Ext.tab.Bar(Ext.apply({ui:c.ui,dock:b,tabRotation:c.getTabRotation(),vertical:(b==="left"||b==="right"),plain:c.plain,tabStretchMax:c.getTabStretchMax(),tabPanel:c,layout:{type:"hbox",pack:c.pack},defaults:{flex:(c.stretchTabs)?1:null,listeners:{delay:250,scope:c,activate:c.onActivateTab,resize:c.onResizeTab}},listeners:{scope:c,render:c.onRenderTabbar,destroy:c.onDestroyTabbar}},a))},onActivateTab:function(a){if(Ext.isEmpty(a)||Ext.isEmpty(a.el)){return}var c=this,b=a.el.getBox();if(b.y<0){Ext.Function.defer(c.onActivateTab,50,c,[a])}else{c.activeEl.animate({duration:300,to:{width:b.width,x:b.x,y:b.y+b.height-1}})}},destroy:function(){var b=this,a=b.activeEl;if(a){a.destroy()}b.callParent(arguments)},onRenderTabbar:function(b){var a=this;a.activeEl=Ext.DomHelper.append(b.el,{tag:"div",cls:"mattabs-active-div"},true);Ext.on({resize:{fn:a.onResponsiveTab,scope:a,buffer:250}})},onResponsiveTab:function(){var b=this,a=b.getActiveTab();if(a){b.onResizeTab(a.tab)}},onDestroyTabbar:function(){var a=this;Ext.un("resize",a.onResponsiveTab)},onResizeTab:function(b){var d=this,a=d.getActiveTab(),c;if(b===a.tab){c=b.el.getBox();d.activeEl.animate({duration:300,to:{width:c.width,x:c.x,y:c.y+c.height-1}})}}});Ext.define("Valence.common.widget.NavDrawer",{extend:"Ext.Container",requires:["Ext.tree.Panel"],xtype:"widget_navdrawer",width:300,config:{title:null},sliding:true,hideOnSelection:true,navIcon:true,maskBodyOnShow:true,navItems:null,navStore:null,height:"100%",layout:{type:"vbox",align:"stretch"},renderTo:null,headerCfg:null,treeCls:"w-navdrawer-tree",treeBodyCls:"w-navdrawer-treebody",treeCfg:{},collapseOnBodyClick:true,clickListenerActive:false,clickListenerSet:false,initComponent:function(){var a=this;if(a.sliding){Ext.apply(a,{x:0,cls:"w-navdrawer",floating:true,renderTo:a.renderTo||Ext.getBody(),shadow:false,height:Ext.getBody().getHeight()})}else{Ext.apply(a,{cls:"w-navdrawer is-active"})}Ext.apply(a,{items:a.buildItems()});a.callParent(arguments);Ext.getBody().on({scope:a,buffer:200,resize:"onResizeBody"})},buildColumns:function(){var a=this;return a.columns||[{xtype:"treecolumn",dataIndex:"text",flex:1,renderer:function(c,b,g){var f=g.get("icon")+" w-navdrawer-icon",e=g.get("style"),d='<span class="{0}" style="{1}"></span>{2}';return Ext.String.format(d,f,e,c)}}]},buildItems:function(){var c=this,b=[],a=(c.navItems)?c.buildStore():c.navStore;if(c.navIcon||c.title){b.push({xtype:"toolbar",cls:"w-navdrawer-header",items:[]});if(c.navIcon){b[0].items.push({iconCls:"vvicon-menu7",ui:"plain",scope:c,handler:c.onClickNavIcon})}if(c.title){b[0].items.push({xtype:"tbtext",cls:"w-navdrawer-title",text:c.title})}}if(c.headerCfg){b.push(c.headerCfg)}b.push(Ext.apply(c.treeCfg,{xtype:"treepanel",flex:1,cls:c.treeCls,bodyCls:c.treeBodyCls,store:a,rootVisible:false,hideHeaders:true,scrollable:"y",columns:c.buildColumns(),listeners:{scope:c,cellclick:c.onCellClickTreeList}}));return b},buildStore:function(){var a=this;return Ext.create("Ext.data.TreeStore",{root:{expanded:true,children:a.navItems}})},applyTitle:function(a){return a},hide:function(){var a=this;a.el.removeCls("is-active");if(a.maskBodyOnShow){Ext.getBody().unmask()}a.clickListenerActive=false},mimicClick:function(b){var a=this,e=a.down("treepanel"),d=e.getStore(),c;if(Ext.isNumber(b)){c=d.getAt(b)}else{if(Ext.isString(b)){c=d.findRecord("event",b,0,false)}}if(c){e.getSelectionModel().select(c);a.fireEvent(c.get("event"),c)}},onBodyClick:function(b){var a=this;if(a.clickListenerActive&&!b.within(a.el)){a.hide()}},onClickNavIcon:function(){var a=this;a.hide()},onCellClickTreeList:function(n,d,l,f,j,m,h){var k=this,g=f.isLeaf(),c=Ext.get(h.getTarget()),b=c.getAttribute("data-event"),a=(g)?f.get("event"):null;if(b){k.fireEvent(b,f)}else{if(a){if(n.getSelection()!==f){k.fireEvent(a,f)}if(k.hideOnSelection){k.hide()}}else{k.clickListenerActive=false;f[f.isExpanded()?"collapse":"expand"]();setTimeout(function(){k.clickListenerActive=true},200)}}},onResizeBody:function(a,c){var b=this;b.setHeight(c.height)},show:function(){var a=this;a.callParent(arguments);if(a.maskBodyOnShow){Ext.getBody().mask();a.toFront()}a.el.addCls("is-active");if(a.collapseOnBodyClick&&!a.clickListenerSet){Ext.getBody().on({scope:a,buffer:150,click:a.onBodyClick});a.clickListenerSet=true}setTimeout(function(){a.clickListenerActive=true},500)}});Ext.define("Valence.common.widget.Selector",{extend:"Ext.view.View",xtype:"widget_selector",store:null,valueField:"value",itemCls:"w-selector-item",overItemCls:"w-selector-item-over",selectedItemCls:"w-selector-item-sel",deselectOnClick:false,trackMouse:true,displayField:"desc",cls:"x-field x-form-item w-selector-wrap",autoSelect:-1,manualSet:false,itemStyle:null,tooltipField:null,isFormField:true,height:27,initComponent:function(){var a=this;if(!Ext.isEmpty(a.additionalCls)){a.cls=a.cls+" "+a.additionalCls}Ext.applyIf(a,{itemSelector:"div."+a.itemCls,tpl:this.buildTpl()});a.callParent(arguments);a.on({scope:a,afterrender:a.onAfterRender,beforeitemclick:a.onBeforeItemClick,selectionchange:a.onSelectionChangeList})},buildTpl:function(){var a=this;return Ext.create("Ext.XTemplate",'<tpl for=".">','<div {[this.getItemStyle(xindex)]} {[this.getTooltip(values)]} class="'+a.itemCls+'">',"{[this.getValue(values)]}","</div>","</tpl>",{getItemStyle:function(b){var c=a.itemStyle;if(a.itemStyle){if(b>1){c+="border-left:none;"}return'style="'+c+'"'}else{if(b>1){return'style="border-left:none;"'}}},getTooltip:function(b){if(a.tooltipField){return'data-qtip="'+b[a.tooltipField]+'"'}},getValue:function(b){return b[a.displayField]}})},deselectSelected:function(){var b=this,c=b.getSelectionModel().getSelection();for(var a=0;a<c.length;a++){b.selModel.deselect(c[a],true)}},getDisplayValue:function(){var c=this,d=c.getSelectionModel().getSelection();if(d.length===0){return null}else{if(d.length===1){return d[0].get(c.displayField)}else{var b=[];for(var a=0;a<d.length;a++){b.push(d[a].get(c.displayField))}return b}}},getSubmitData:function(){var a=this,b={};b[a.name]=a.getValue();return b},getSubmitValue:function(){var a=this;return a.getValue()},getValue:function(){var c=this,d=c.getSelectionModel().getSelection();if(d.length===0){return null}else{if(d.length===1){return d[0].get(c.valueField)}else{var b=[];for(var a=0;a<d.length;a++){b.push(d[a].get(c.valueField))}return b}}},isDirty:function(){return false},isFileUpload:function(){return false},isValid:function(){return true},setValue:function(a){var c=this,d=[],f,g=c.getSelectionModel(),e=c.store;c.manualSet=true;if(!Ext.isArray(a)){d.push(a)}else{d=a}for(var b=0;b<d.length;b++){f=e.findRecord(c.valueField,d[b]);if(f){c.getSelectionModel().select(e.indexOf(f));c.fireEvent("change",c,f)}}c.manualSet=false},validate:function(){return true},onAfterRender:function(){var a=this;if(a.autoSelect!==-1){if(a.store.getCount()>0){a.getSelectionModel().select(a.autoSelect)}else{a.store.on({scope:a,single:true,load:a.onAfterRender})}}},onBeforeItemClick:function(c,a){var b=this;if(!b.manualSet&&b.deselectOnClick&&b.selModel.isSelected(c)){b.selModel.deselect(c,true);b.fireEvent("itemunclick",a,c);return false}},onSelectionChangeList:function(a,c){var b=this;b.fireEvent("change",b,c)},reset:function(){var a=this;if(a.autoSelect!==-1){if(a.store.getCount()>0){a.getSelectionModel().select(a.autoSelect)}}}});Ext.define("Valence.common.widget.VideoInvite",{extend:"Ext.toolbar.Toolbar",ui:"secondary-dark",xtype:"widget_videoinvite",storageItem:null,url:null,text:null,autoHideSeconds:30,cls:"w-video-invite",layout:{type:"hbox",pack:"middle"},initComponent:function(){var a=this;Ext.apply(a,{floating:true,shadow:false,renderTo:a.renderTo||Ext.getBody(),style:{opacity:0},width:"40%"});a.callParent(arguments);a.on({scope:a,delay:500,afterrender:a.onAfterRender,viewvideo:a.onClickClose})},buildItems:function(){var a=this;return[{xtype:"tbtext",flex:1,text:Ext.String.format('{0}<a data-event="viewvideo" href="{1}" target="_blank">{2}</a>',a.text,a.url,Ext.util.Format.uppercase(Valence.lang.lit.viewVideo)),listeners:{el:{scope:a,click:a.onClickText}}},{ui:"plain",scope:a,iconCls:"close-icon vvicon-cancel-circle",handler:a.onClickClose}]},onAfterRender:function(b){var a=this;if(!a.storageItem||!a.url||!a.text){a.destroy()}else{if(localStorage.getItem(a.storageItem)==="true"){a.destroy()}else{if(Valence.util.Helper.getLanguage()!=="en"){a.destroy()}else{a.add(a.buildItems());a.el.anchorTo(a.renderTo,"bc-bc");a.renderTo.on({scope:a,scroll:a.onScrollRenderTo});a.show();a.el.fadeIn({duration:500});a.interval=setTimeout(function(){a.el.fadeOut({callback:function(){a.destroy()}})},a.autoHideSeconds*1000)}}}},onClickClose:function(){var a=this;localStorage.setItem(a.storageItem,true);a.el.fadeOut({callback:function(){a.destroy()}})},onClickText:function(d){var c=this,a=Ext.get(d.getTarget()),b=a.getAttribute("data-event");if(b){c.fireEvent(b)}},onDestroy:function(){var a=this;clearInterval(a.interval);a.renderTo.un("scroll",a.onScrollRenderTo,a);a.callParent(arguments)},onScrollRenderTo:function(){var a=this;a.el.anchorTo(a.renderTo,"bc-bc")}});Ext.define("Valence.common.widget.hsteps.HStepsModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.hsteps"});Ext.define("Valence.common.widget.hsteps.HStepsController",{extend:"Ext.app.ViewController",alias:"controller.hsteps",onAfterrender:function(){var b=this,a=b.getView();if(!Ext.isEmpty(a.autoSelect)){a.getSelectionModel().select(a.autoSelect)}},onBeforeselectStep:function(k,e){var j=this,l=j.getView(),b=e.get("event"),a=l.selection,c=(a)?a.get("event"):null,h,d,g,f;if(b){if(c){if(j.fireViewEvent("beforeleave"+c,a,e)===false){return false}}if(j.fireViewEvent("before"+b)===false){return false}h=l.getStore();d=h.getCount();g=h.indexOf(e);f={index:g,previous:(g>0),next:(g<(d-1))};j.fireViewEvent(b,e,f)}}});Ext.define("Valence.common.widget.hsteps.HSteps",{extend:"Ext.view.View",requires:["Valence.common.widget.hsteps.HStepsModel","Valence.common.widget.hsteps.HStepsController"],xtype:"widget_hsteps",viewModel:{type:"hsteps"},controller:"hsteps",itemSelector:"div.hs-step-wrap",selectedItemCls:"hs-selected",cls:"hs-wrap",autoSelect:0,tpl:['<div class="hs-inner">','<tpl for=".">','<div class="hs-step-wrap {[this.getAdditionalCls(values)]}">','<div class="hs-step">',"<tpl if=\"sts == 'C'\">",'<div class="hs-step-circle"><div class="vvicon-checkmark hs-step-cmpl"></div></div>',"<tpl elseif=\"sts == 'I'\">",'<div class="hs-step-circle"><div class="vvicon-warning hs-step-incmpl"></div></div>',"<tpl else>",'<div class="hs-step-circle">{[this.getStepValue(values, xindex)]}</div>',"</tpl>",'<div class="hs-step-text">{text}</div>','<tpl if="subtext">','<div class="hs-step-subtext">{subtext}</div>',"</tpl>","</div>",'<div class="hs-step-line"></div>',"</div>","</tpl>","</div>",{getAdditionalCls:function(a){if(a.sts&&a.sts==="C"){return"hs-complete"}else{if(a.sts&&a.sts==="I"){return"hs-incomplete"}}},getStepValue:function(a,b){if(!Ext.isEmpty(a.step)){return a.step}return b}}],listeners:{beforeselect:"onBeforeselectStep",afterrender:{delay:200,fn:"onAfterrender"}},first:function(){var a=this,c=a.getStore(),b=c.getAt(0);if(!Ext.isEmpty(b)){a.getSelectionModel().select(b)}},getCurrentStep:function(){var b=this,a=b.getSelection();if(!Ext.isEmpty(a)){return b.getSelection()[0]}return null},next:function(b){var d=this,f=d.getStore(),c=f.getCount()-1,e=d.getSelection()[0],a;if(e){if(b){e.set("sts","C")}a=f.indexOf(e);a+=1;if(a<=c){d.getSelectionModel().select(f.getAt(a))}}},previous:function(a){var c=this,e=c.getStore(),d=c.getSelection()[0],b;if(d){b=e.indexOf(d);b-=1;if(b>=0){if(a){e.getAt(b).set("sts","")}c.getSelectionModel().select(e.getAt(b))}}},setActive:function(a){var b=this,c=b.getStore();if(!Ext.isEmpty(a)){b.getSelectionModel().select(a)}}});